{# templates/profil/index.html.twig #}
{% extends 'base.html.twig' %}

{% block title %}Profil de l'utilisateur{% endblock %}

{% block body %}
    <div class="w-100 bg-main pt-5">
        <div class="container my-4 pt-3 bg-light rounded-5 shadow">

            <div class="row flex-column flex-md-row">
                <!-- ‚úÖ Colonne gauche : navigation -->
                <div class="col-md-3 col-sm-4 my-2 sidebar-nav">
                    <ul class="nav nav-tabs flex-column text-center">
                        <li class="nav-item mb-2">
                            <a class="nav-link d-flex flex-column align-items-center justify-content-center{{ (app.request.attributes.get('donnees') == 'profile' or app.request.attributes.get('_route') == 'app_profil') ? ' active' : '' }}"
                               href="{{ path('app_profil') }}">
                                <img src="{{ asset('images/webp/element-4.svg') }}" alt="Profil" role="img" aria-label="Photo de profil" style="width:16px; height:16px;">
                                <span class="mt-1" style="font-size: 16px">Profil</span>
                            </a>
                        </li>

                        <li class="nav-item mb-2">
                            <a class="nav-link d-flex flex-column align-items-center justify-content-center{{ (app.request.attributes.get('donnees') == 'orders') ? ' active' : '' }}"
                               href="{{ path('app_profil_page', {'page': '1', 'donnees': 'orders'}) }}">
                                <img src="{{ asset('images/webp/cart-frame.svg') }}" alt="Commandes" style="width:16px; height:16px;">
                                <span class="mt-1" style="font-size: 16px">Commandes</span>
                            </a>
                        </li>

                        <li class="nav-item mb-2">
                            <a class="nav-link d-flex flex-column align-items-center justify-content-center{{ (app.request.attributes.get('donnees') == 'payments') ? ' active' : '' }}"
                               href="{{ path('app_profil_page', {'page': '1', 'donnees': 'payments'}) }}">
                                <img src="{{ asset('images/webp/cash.svg') }}" alt="Paiements" style="width:16px; height:16px;">
                                <span class="mt-1" style="font-size: 16px">Paiements</span>
                            </a>
                        </li>
                    </ul>
                </div>

                <!-- ‚úÖ Colonne droite : contenu dynamique -->
                <div class="col-md-9 text-start p-3">

                    <p class="fs-5 mb-1">Bienvenue, {{ user.email }}</p>
                    <p id="date" class="text-muted"></p>

                    <div class="container rounded mb-4">
                        <img src="{{ asset('images/webp/degrade.png') }}" class="rounded-top-3 mb-5" style="height: 100px; width: 100%;" alt="">

                        <div class="d-flex align-items-center">
                            {% if user.profilePicture %}
                                <!-- ‚úÖ Photo de profil existante -->
                                <img src="{{ asset('uploads/profilePictures/' ~ user.profilePicture) }}"
                                     class="rounded-circle shadow me-3"
                                     style="width: 150px; height: 150px; object-fit: cover;">
                                <div>
                                    <a href="{{ path('edit_profile_picture') }}" class="btn btn-primary me-2">
                                        <i class="bi bi-pencil"></i>
                                    </a>
                                    <a href="{{ path('delete_profile_picture') }}"
                                       onclick="return confirm('√ätes-vous s√ªr de vouloir supprimer l\'image ?')"
                                       class="btn btn-danger">
                                        <i class="bi bi-trash" style="color:white"></i>
                                    </a>
                                </div>
                            {% else %}
                                <!-- ‚úÖ Photo par d√©faut -->
                                <div class="d-flex flex-column align-items-start">
                                    <img src="{{ asset('images/user_profil.jpg') }}"
                                         class="rounded-circle shadow mb-2"
                                         style="width: 95px; height: 95px; object-fit: cover;">
                                    <a href="{{ path('edit_profile_picture') }}"
                                       class="shadow rounded-circle bg-light d-flex justify-content-center align-items-center linkedin-circle"
                                       style="width:36px;height:36px;">
                                        <img src="{{ asset('images/webp/edit-03.svg') }}" style="width:18px;">
                                    </a>
                                </div>
                            {% endif %}

                            <div class="ms-4">
                                <p class="fs-4">
                                    {{ user.email }}
                                    <i class="bi bi-patch-check {{ user.isVerified == 1 ? 'text-success' : 'text-danger' }}"></i>
                                    {% if user.isVerified == 0 %}
                                        <a href="{{ path('app_verify_email_renew', {'id': user.id}) }}">Demander un nouvel envoi d'email de confirmation</a>
                                    {% endif %}
                                </p>
                                <p>Identifiant : {{ user.id }}</p>
                            </div>
                        </div>
                    </div>

                    {# üîÑ Contenu dynamique selon le menu cliqu√© #}
                    {% set section = app.request.attributes.get('donnees') ?? (app.request.attributes.get('_route') == 'app_profil' ? 'profile' : '') %}

                    {% if section == 'profile' %}
                        <!-- üßç‚Äç‚ôÇÔ∏è Formulaire du profil -->
                        <div class="container my-5 p-4 bg-light rounded shadow">
                            <form action="#" method="post" class="text-start">
                                <div class="row">
                                    <!-- Colonne gauche -->
                                    <div class="col-12 col-md-6">
                                        <div class="mb-3">
                                            <label for="firstName" class="form-label">
                                                Pr√©nom <span style="color:#FF1DBB">*</span>
                                            </label>
                                            <input type="text" class="form-control" id="firstName" name="firstName"
                                                   placeholder="Entrez votre pr√©nom"
                                                   value="{{ data_items['data'][0].payer.firstName ?? '' }}">
                                        </div>

                                        <div class="mb-3">
                                            <label for="address" class="form-label">
                                                Adresse <span style="color:#FF1DBB">*</span>
                                            </label>
                                            <input type="text" class="form-control" id="address" name="address"
                                                   placeholder="Entrez votre adresse"
                                                   value="{{ data_items['data'][0].payer.address ?? '' }}">
                                        </div>

                                        <div class="mb-3">
                                            <label for="zipCode" class="form-label">
                                                Code postal <span style="color:#FF1DBB">*</span>
                                            </label>
                                            <input type="text" class="form-control" id="zipCode" name="zipCode"
                                                   placeholder="Entrez votre code postal"
                                                   value="{{ data_items['data'][0].payer.zipCode ?? '' }}">
                                        </div>
                                    </div>

                                    <!-- Colonne droite -->
                                    <div class="col-12 col-md-6">
                                        <div class="mb-3">
                                            <label for="lastName" class="form-label">
                                                Nom <span style="color:#FF1DBB">*</span>
                                            </label>
                                            <input type="text" class="form-control" id="lastName" name="lastName"
                                                   placeholder="Entrez votre nom"
                                                   value="{{ data_items['data'][0].payer.lastName ?? '' }}">
                                        </div>

                                        <div class="mb-3">
                                            <label for="city" class="form-label">
                                                Ville <span style="color:#FF1DBB">*</span>
                                            </label>
                                            <input type="text" class="form-control" id="city" name="city"
                                                   placeholder="Entrez votre ville"
                                                   value="{{ data_items['data'][0].payer.city ?? '' }}">
                                        </div>

                                        <div class="mb-3">
                                            <label for="phone" class="form-label">
                                                Num√©ro de t√©l√©phone <span style="color:#FF1DBB">*</span>
                                            </label>
                                            <input type="text" class="form-control" id="phone" name="phone"
                                                   placeholder="Entrez votre num√©ro de t√©l√©phone"
                                                   value="{{ data_items['data'][0].payer.phone ?? '' }}">
                                        </div>
                                    </div>
                                </div>

                                <!-- ‚úÖ Mention des champs obligatoires -->
                                <p class="mt-3 text-center" style="color:#FF1DBB;">
                                    Champs obligatoires <span>*</span>
                                </p>
                                <div class="text-center mt-4">
                                    <button type="submit" class="btn btn-success px-4">
                                        <i class="bi bi-save"></i> Enregistrer les modifications
                                    </button>
                                </div>

                            </form>
                        </div>

                    {% elseif section == 'orders' %}
                        <!-- üõí Section Commandes -->
                        <div class="container my-5">
                            <h4>Mes derni√®res commandes</h4>
                            {% if data_items is defined and data_items['data'] is not empty %}
                                {% for item in data_items['data'] %}
                                    {% include 'profil/orders.html.twig' %}
                                {% endfor %}
                            {% else %}
                                <p>Aucune commande √† afficher.</p>
                            {% endif %}
                        </div>

                    {% elseif section == 'payments' %}
                        <!-- üí∂ Section Paiements -->
                        <div class="container my-5">
                            <h4>Mes paiements</h4>
                            {% if data_items is defined and data_items['data'] is not empty %}
                                {% for item in data_items['data'] %}
                                    {% include 'profil/payments.html.twig' %}
                                {% endfor %}
                            {% else %}
                                <p>Aucun paiement √† afficher.</p>
                            {% endif %}
                        </div>
                    {% endif %}
                </div> <!-- Fin colonne droite -->
            </div> <!-- Fin row -->
        </div> <!-- Fin container -->
    </div>
    <style>
        /* ‚úÖ Taille de la colonne */
        .sidebar-nav {
            flex: 0 0 200px;
            max-width: 220px;
        }

        @media (max-width: 991px) {
            .sidebar-nav {
                flex: 0 0 180px;
                max-width: 180px;
            }
        }

        @media (max-width: 767px) {
            .sidebar-nav {
                flex: 0 0 100%;
                max-width: 100%;
                margin-bottom: 1rem;
            }
        }

        /* ‚úÖ Apparence des onglets */
        .nav-tabs {
            border-bottom: none !important;
        }

        .nav-tabs .nav-link {
            border: none !important;
            border-radius: 10px;
            transition: background-color 0.2s ease;
            font-size: 16px;
        }

        .nav-tabs .nav-link.active {
            background-color: #f0f0f0;
            font-weight: 600;
        }

        .nav-tabs .nav-link:hover {
            background-color: #f8f9fa;
        }
    </style>

    <script>
        // R√©cup√®re la date du jour
        const today = new Date();
        const options = {year: 'numeric', month: 'long', day: 'numeric'};
        const formattedDate = today.toLocaleDateString('fr-FR', options);
        document.getElementById('date').textContent = formattedDate;
    </script>
{% endblock %}
