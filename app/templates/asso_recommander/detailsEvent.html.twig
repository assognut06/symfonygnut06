{% extends 'base.html.twig' %}

{% block title %}
	{{ data_actu.title }}
{% endblock %}

{% block body %}
	<div class="container pt-5">
		<div class="mx-3">
			{% if data_actu.banner is defined and data_actu.banner.publicUrl %}
				<img src="{{ data_actu.banner.publicUrl }}" class="card-img-top" alt="Banni√®re de {{ data_actu.title }}">
			{% endif %}
			<h2 class="my-5 gradient-text text-center">{{ data_actu.title }}</h2>
			<div class="border border-secondary mb-5 mx-5 "></div>
			<div class="row justify-content-center text">
				{% if data_actu.logo is defined and data_actu.logo.publicUrl %}
					<div class="col-12 col-lg-4 text-center my-5">
						<img src="{{ data_actu.logo.publicUrl }}" class="card-img-top logoAsso shadow-lg" alt="Logo de {{ data_actu.title }}">
					</div>
				{% endif %}
				{% if data_actu.description is defined and data_actu.description %}
					<div class="col-12 text-center">
						<p class="fs-4">{{ data_actu.description|nl2br }}</p>
					</div>
				{% endif %}
				{% if data_actu.saleEndDate is defined and data_actu.saleEndDate %}
					<div class="col-12 text-center">
						<div class="alert alert-danger text-center mx-5 shadow-lg rounded-pill" role="alert">
							<p>Date limite de r√©servation :
								{{ data_actu.saleEndDate|format_datetime(pattern="EEEE d MMMM y '√†' HH'h'mm", locale='fr', timezone='Europe/Paris') }}</p>
							{% if data_actu.saleEndDate > "now"|date('Y-m-d') %}
								{% set endDate = data_actu.saleEndDate|date('Y-m-d') %}
								{% set now = "now"|date('Y-m-d') %}
								{% if endDate > now %}
									{% set interval = date(endDate).diff(date(now)) %}
									<strong>Expire dans
										{{ interval.days }}
										jours.</strong>
								{% endif %}
							{% endif %}
						</div>
					</div>
				{% endif %}

				{% if data_actu.endDate is defined and data_actu.endDate %}
					<div class="col-12 col-lg-4 text-center d-flex flex-column align-self-center text">
						{% if data_actu.place is defined and data_actu.place %}
							<h5>{{ data_actu.place.name }}</h5>
							<div>
								<p>Adresse :
									{{ data_actu.place.address }}<br>{{ data_actu.place.zipCode }}
									{{ data_actu.place.city }}
								</p>
							</div>
						{% endif %}
					</div>
					<div class="col-12 col-lg-4 text-center d-flex flex-column align-self-center">
						<div class="alert alert-danger text-center mx-5 mb-5 mt-2 shadow-lg rounded-pill" role="alert">
							{% set endDate = data_actu.endDate|date('Y-m-d') %}
							{% set now = "now"|date('Y-m-d') %}
							{% if endDate > now %}
								{% set interval = date(endDate).diff(date(now)) %}
								<strong>Expire dans
									{{ interval.days }}
									jours.</strong>
							{% endif %}
						</div>
						<div class="alert alert-success text-center mx-5 mb-5 shadow-lg rounded-pill" role="alert">
							{% if data_actu.startDate is defined and data_actu.startDate %}
								D√©bute le
								{{ data_actu.startDate|format_datetime(pattern="EEEE d MMMM y '√†' HH'h'mm", locale='fr', timezone='Europe/Paris') }}<br>
							{% endif %}
							Fini le
							{{ data_actu.endDate|format_datetime(pattern="EEEE d MMMM y '√†' HH'h'mm", locale='fr', timezone='Europe/Paris') }}
						</div>
					</div>

					<div class="col-12 col-lg-4 text-center d-flex flex-column align-self-center mt-3">
						{% if data_actu.place is defined and data_actu.place %}
							<iframe width="100%" height="450" style="border:0" loading="lazy" allowfullscreen referrerpolicy="no-referrer-when-downgrade" src="https://www.google.com/maps/embed/v1/place?key={{ googleMapsApiKey }}&q={{ data_actu.place.name|url_encode }},{{ data_actu.place.address|url_encode }}+{{ data_actu.place.zipCode }}+{{ data_actu.place.city|url_encode }},{{ data_actu.place.country }}"></iframe>
						{% endif %}
					</div>

				{% endif %}
				{% if data_actu.tiers is defined and data_actu.tiers %}
					<div
						class="col-12">
						<!-- üñ•Ô∏è Version Desktop - Tableau -->
						<div class="d-none d-md-block mt-5"  aria-labelledby="tarifs-title">
							<table class="table table-success table-striped  table-hover mt-5">
								<thead>
									<tr>
										<th scope="col">Formule</th>
										<th scope="col">Description</th>
										<th scope="col">Tarif</th>
									</tr>
								</thead>
								<tbody>
									{% for tier in data_actu.tiers %}
										<tr>
											<th scope="row">
												{% if tier.label is defined and tier.label %}
													{{ tier.label }}
												{% else %}
													Formule
													{{ loop.index }}
												{% endif %}
											</th>
											<td>
												{% if tier.description is defined and tier.description %}
													{{ tier.description }}
												{% endif %}
											</td>
											<td>
												{% if tier.price is defined and tier.price %}
													{{ (tier.price / 100)|number_format(2, ',', ' ') }}
													‚Ç¨
												{% endif %}
											</td>
										</tr>
									{% else %}
										<tr>
											<td colspan="3">Aucune formule disponible.</td>
										</tr>
									{% endfor %}
								</tbody>
							</table>
						</div>

						<!-- üì± Version Mobile - Cartes -->
						<div class="d-md-none mt-5">
							{% for tier in data_actu.tiers %}
								<div class="card mb-3 bg-light border-success">
									<div class="card-header bg-success text-white">
										<h5 class="card-title mb-0">
											{% if tier.label is defined and tier.label %}
												{{ tier.label }}
											{% else %}
												Formule
												{{ loop.index }}
											{% endif %}
										</h5>
									</div>
									<div class="card-body">
										{% if tier.description is defined and tier.description %}
											<p class="card-text">{{ tier.description }}</p>
										{% endif %}
										{% if tier.price is defined and tier.price %}
											<div class="d-flex justify-content-between align-items-center">
												<span class="badge bg-success fs-6 px-3 py-2">
													{{ (tier.price / 100)|number_format(2, ',', ' ') }}
													‚Ç¨
												</span>
											</div>
										{% endif %}
									</div>
								</div>
							{% else %}
								<div class="alert alert-info text-center">
									<i class="bi bi-info-circle"></i>
									Aucune formule disponible.
								</div>
							{% endfor %}
						</div>
					</div>
				{% endif %}
				<div class="col-12 mt-3 text-center">
					{% if data_actu.saleEndDate is defined and data_actu.saleEndDate < "now"|date('Y-m-d') %}
						<div class="alert alert-danger text-center mx-5 shadow-lg rounded-pill text-primary" role="alert">
							<strong>
								<i class="bi bi-door-closed-fill"></i>Les r√©servations sont closes.</strong>
						</div>
					{% else %}
						<button class="btn-neon text mt-3" role="button" data-bs-toggle="modal" data-bs-target="#modal_tier">
							{% if app.request.attributes.get('formType') == 'Event' %}
								<i class="bi bi-calendar-event-fill"></i>
								R√©server
							{% elseif app.request.attributes.get('formType') == 'Donation' %}
								<i class="bi bi-check"></i>
								Faire un don
							{% elseif app.request.attributes.get('formType') == 'Membership' %}
								<i class="bi bi-person-badge-fill"></i>
								Adh√©rer
							{% elseif app.request.attributes.get('formType') == 'CrowdFunding' %}
								<i class="bi bi-people-fill"></i>
								Soutenir
							{% elseif app.request.attributes.get('formType') == 'Shop' %}
								<i class="bi bi-shop"></i>
								Acheter
							{% endif %}
						</button>
						<!-- Modal -->
						<div class="modal fade modal-{% if app.request.attributes.get('formType') == 'Donation' %}xl{% else %}lg{% endif %}" id="modal_tier" tabindex="-1" aria-labelledby="ModalLabel_tier" aria-hidden="true">
							<div class="modal-dialog">
								<div class="modal-content">
									<div class="modal-header">
										<h1 class="modal-title fs-5" id="ModalLabel_tier">{{ data_actu.title }}</h1>
										<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
									</div>
									<div class="modal-body">
										<iframe id="haWidget" allowtransparency="true" scrolling="auto" src="{{ data_actu.widgetFullUrl }}" style="width: 100%; border: none;" onload="window.addEventListener( 'message', e => { const dataHeight = e.data.height; const haWidgetElement = document.getElementById('haWidget'); haWidgetElement.height = dataHeight + 'px'; } )"></iframe>
									</div>
									<div class="modal-footer">
										<button type="button" class="btn-asso" data-bs-dismiss="modal">Fermer</button>
									</div>
								</div>
							</div>
						</div>
					{% endif %}
				</div>
				<div class="col-12 my-4 text-center">
					{% if app.request.headers.get('Referer') %}
						<a class="btn btn-outline-success text-white" href="{{ app.request.headers.get('Referer')|e('html_attr') }}">
							<i class="bi bi-skip-backward-circle text-white"></i>
							Retour</a>
					{% else %}
						<p>Impossible de retourner √† la page pr√©c√©dente.</p>
					{% endif %}
				</div>
			</div>
		</div>
	</div>
{% endblock %}
